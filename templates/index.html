<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ร้านขายหนังสือออนไลน์</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/powerbi-client@2.15.1/dist/powerbi.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>
<body >
  <div class = "grid-container">
    <div class = "header">
        <section style="border: solid black; margin-left: 10px; margin-right: 10px; margin-top: 10px; background-color:rgb(41, 40, 40); border-radius: 1%; color: white;" id="home" >
          <h1 style="margin-left: 20px; text-align: center;">Icon</h1>
          <form id = "searchform"style="color: black;">
            <h1 style="color: rgb(255, 255, 255);">ค้นหา</h1>
            <h2 style="margin-right:20px; color: rgb(0, 0, 0);"></h2>
            <input type="text" id="search-input">
            <div id="filter-container">
            <select id="filter" name = f>
              <option value="ทั้งหมด">ทั้งหมด</option>
              <option value="หนังสือ ไลฟ์สไตล์">หนังสือ ไลฟ์สไตล์</option>
              <option value="ศาสนา & โหราศาสตร์">ศาสนา & โหราศาสตร์	</option>
              <option value="งานอดิเรก">งานอดิเรก	</option>
              <option value="ปรัชญา">ปรัชญา</option>
              <option value="หนังสือจิตวิทยา พัฒนาตนเอง">หนังสือจิตวิทยา พัฒนาตนเอง	</option>
              <option value="หนังสือเด็ก">หนังสือเด็ก	</option>
              <option value="อาหารและเครื่องดื่ม">อาหารและเครื่องดื่ม</option>
              <option value="หนังสือการบริหารธุรกิจ">งานอดิเรก	</option>
              <option value="คู่มือเตรียมสอบ">ปรัชญา</option>
              <option value="วิชาการและการเรียนรู้">หนังสือจิตวิทยา พัฒนาตนเอง	</option>
              <option value="คู่มือเตรียมสอบเข้ารับราชการ	">หนังสือเด็ก	</option>
              <option value="ภาษาศาสตร์">อาหารและเครื่องดื่ม</option>
              </select>
            </div>
            <button id="search-button" type="submit" onclick="denyslash()">ค้นหา</button>
          </form>
    </div>

    <!-- เนื้อหาหน้าแรก -->

        <!-- เพิ่มเนื้อหาเพิ่มเติมที่นี่ -->
    </section>
    
    <section style="background-color:whitesmoke; border: solid; 
    margin: 20px; display: flex;">
  
    <nav class = "menu">
        <ul style="border: solid; margin-right: 15px; background-color: antiquewhite;">
            <li><a href="/" disabled>หน้าแรก</a></li>
            <li><a href="#decision-support-system">ระบบสนับสนุนการตัดสินใจ</a></li>
            <li id = "login"><a href="#login-signup">เข้าสู่ระบบ / สมัครสมาชิก</a></li>
        </ul>
    </nav>
    <div style=" background-color:whitesmoke; border: solid;" class = "main">  
      <div class = "best_sell">
        <h1 style="text-align: center;">หนังสือขายดี</h1>
        <div style=" margin: 10px; display: inline-flex" id = "most_buy">
          <div style="display: grid;grid-template-columns: 20% 20% 20% 20% 20%">
            {% for index in data[1]%}
            <tbody class ="grid-container">
              <div style=" width: 90%; height: 100%;margin-left: 10px; text-align: center; border: solid; border-radius: 8%; padding: 10px; margin-bottom: 20px; background-color: antiquewhite"><!-- 1 box -->
                <tr style="border:solid; " class="grid-container">
                  <td><img src = "{{index[8]}}" style="width: 40%; height: 60%; border: solid;"></td>
                  <br>
                  <div>
                    <td >{{index[1]}}</td><br>
                    <td >{{index[9]}}<br>
                      <a href="/addcart/{{index[0]}}" class="btn btn-warning btn-xs" data-toggle="modal" data-target="#modaledit{{index[0]}}">Buy</a><br></div>
                    </td>
                    <br>
                  </tr>
                </div>
              </tbody>
              <div id="modaledit{{index[0]}}" class="modal fade" role="dialog" style="color: black;"><!-- เนื้อหาหนังสือ -->
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                      <h4 class="modal-title">อัพเดทข้อมูลหนังสือ</h4>
                    </div>
                    <div class="modal-body">
                      <form action="/addcart/{{index[0]}}" method="POST">
                        <img src = "{{index[8]}}" style="height: 100px;">
                        <div class="form-group">
                          <label>Book Name</label>
                          <p>{{index[1]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Publisher</label>
                          <p>{{index[2]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Type</label>
                          <p>{{index[3]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Category</label>
                          <p>{{index[4]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Author</label>
                          <p>{{index[5]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Description</label>
                          <p>{{index[6]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Store</label>
                          <p>{{index[7]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Price</label>
                          <p>{{index[9]}}</p>
                        </div>
                        <div class="form-group">
                          <input type="number" class="form-control" name="wanted" value="1"min="1" max="{{index[7]}}">
                          {% if data[0][0] ==0 %}
                          <button class="btn btn-primary" type="submit" disabled>Add to Cart</button>
                          {% else %}
                          <button class="btn btn-primary" type="submit" >Add to Cart</button>
                          {% endif %}
                        </div>
                        <input style="display: none;" value = "mainpage" name = "url"></input>
                      </form>
                    </div>
                  </div>
                </div>
            </div>
              {% endfor %}
            </div>
          </div>
      </div>
      <div class = "best_sell">
        <h1 style="text-align: center;">หนังสือขายดี</h1>
        <div style=" margin: 10px; display: inline-flex" id = "most_buy">
          <div style="display: grid;grid-template-columns: 20% 20% 20% 20% 20%">
            {% for index in data[1]%}
            <tbody class ="grid-container">
              <div style=" width: 90%; height: 100%;margin-left: 10px; text-align: center; border: solid; border-radius: 8%; padding: 10px; margin-bottom: 20px; background-color: antiquewhite"><!-- 1 box -->
                <tr style="border:solid; " class="grid-container">
                  <td><img src = "{{index[8]}}" style="width: 40%; height: 60%; border: solid;"></td>
                  <br>
                  <div>
                    <td >{{index[1]}}</td><br>
                    <td >{{index[9]}}<br>
                      <a href="/addcart/{{index[0]}}" class="btn btn-warning btn-xs" data-toggle="modal" data-target="#modaledit{{index[0]}}">Buy</a><br></div>
                    </td>
                    <br>
                  </tr>
                </div>
              </tbody>
              <div id="modaledit{{index[0]}}" class="modal fade" role="dialog" style="color: black;"><!-- เนื้อหาหนังสือ -->
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                      <h4 class="modal-title">อัพเดทข้อมูลหนังสือ</h4>
                    </div>
                    <div class="modal-body">
                      <form action="/addcart/{{index[0]}}" method="POST">
                        <img src = "{{index[8]}}" style="height: 100px;">
                        <div class="form-group">
                          <label>Book Name</label>
                          <p>{{index[1]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Publisher</label>
                          <p>{{index[2]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Type</label>
                          <p>{{index[3]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Category</label>
                          <p>{{index[4]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Author</label>
                          <p>{{index[5]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Description</label>
                          <p>{{index[6]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Store</label>
                          <p>{{index[7]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Price</label>
                          <p>{{index[9]}}</p>
                        </div>
                        <div class="form-group">
                          <input type="number" class="form-control" name="wanted" value="1"min="1" max="{{index[7]}}">
                          {% if data[0][0] ==0 %}
                          <button class="btn btn-primary" type="submit" disabled>Add to Cart</button>
                          {% else %}
                          <button class="btn btn-primary" type="submit" >Add to Cart</button>
                          {% endif %}
                        </div>
                        <input style="display: none;" value = "mainpage" name = "url"></input>
                      </form>
                    </div>
                  </div>
                </div>
            </div>
              {% endfor %}
            </div>
          </div>
      </div>
      <div class = "best_sell">
        <h1 style="text-align: center;">หนังสือขายดี</h1>
        <div style=" margin: 10px; display: inline-flex" id = "most_buy">
          <div style="display: grid;grid-template-columns: 20% 20% 20% 20% 20%">
            {% for index in data[1]%}
            <tbody class ="grid-container">
              <div style=" width: 90%; height: 100%;margin-left: 10px; text-align: center; border: solid; border-radius: 8%; padding: 10px; margin-bottom: 20px; background-color: antiquewhite"><!-- 1 box -->
                <tr style="border:solid; " class="grid-container">
                  <td><img src = "{{index[8]}}" style="width: 40%; height: 60%; border: solid;"></td>
                  <br>
                  <div>
                    <td >{{index[1]}}</td><br>
                    <td >{{index[9]}}<br>
                      <a href="/addcart/{{index[0]}}" class="btn btn-warning btn-xs" data-toggle="modal" data-target="#modaledit{{index[0]}}">Buy</a><br></div>
                    </td>
                    <br>
                  </tr>
                </div>
              </tbody>
              <div id="modaledit{{index[0]}}" class="modal fade" role="dialog" style="color: black;"><!-- เนื้อหาหนังสือ -->
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                      <h4 class="modal-title">อัพเดทข้อมูลหนังสือ</h4>
                    </div>
                    <div class="modal-body">
                      <form action="/addcart/{{index[0]}}" method="POST">
                        <img src = "{{index[8]}}" style="height: 100px;">
                        <div class="form-group">
                          <label>Book Name</label>
                          <p>{{index[1]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Publisher</label>
                          <p>{{index[2]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Type</label>
                          <p>{{index[3]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Category</label>
                          <p>{{index[4]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Author</label>
                          <p>{{index[5]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Description</label>
                          <p>{{index[6]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Store</label>
                          <p>{{index[7]}}</p>
                        </div>
                        <div class="form-group">
                          <label>Price</label>
                          <p>{{index[9]}}</p>
                        </div>
                        <div class="form-group">
                          <input type="number" class="form-control" name="wanted" value="1"min="1" max="{{index[7]}}">
                          {% if data[0][0] ==0 %}
                          <button class="btn btn-primary" type="submit" disabled>Add to Cart</button>
                          {% else %}
                          <button class="btn btn-primary" type="submit" >Add to Cart</button>
                          {% endif %}
                        </div>
                        <input style="display: none;" value = "mainpage" name = "url"></input>
                      </form>
                    </div>
                  </div>
                </div>
            </div>
              {% endfor %}
            </div>
          </div>
      </div>
    </div>

  

<!-- เพิ่มเนื้อหาของแต่ละส่วนต่อไป -->
</section>
</div>
</div>

    <br><br>
    <footer>
    </footer>
    <script>
      var url
      document.getElementById('searchform').addEventListener("submit",function(event){
          event.preventDefault(); // ป้องกันการโหลดหน้าใหม่เมื่อ submit form
          if(document.getElementById('search-input').value == ""){
            url = "/search/"+document.getElementById("filter").value+"/-"
          }
          else{
            url = "/search/"+document.getElementById("filter").value+"/"+document.getElementById('search-input').value.replace("/","+-=");
          }
          window.location.href = url
        })
      console.log(document.getElementById("filter").value)
      
        flask_data = '{{data}}'
        flask_data = flask_data.replaceAll("&#39;","").slice(1, -1)
        pre_array = flask_data.split('(')
        console.log(flask_data)
        var i,data,x
        array = []
        array2 = []
        for (i=1 ; i <pre_array.length ;i++){
          data = pre_array[i].split(')')
          array.push(data[0])
        }
        array = array[0].split(', ')
        console.log(array[0])
        if(parseInt(array[0]) == 0){
          console.log('not login')
          x = "<a href=\"/login\" class=\"\">เข้าสู่ระบบ</a>"
          document.getElementById("login").innerHTML = x
        }
        else if(parseInt(array[0]) == 1){
          console.log('admin')
          x = "<li><a href=\"/status\">สถานะ</a></li><li><a href=\"./userinfo\">ข้อมูลรหัส</a></li>\
          <li><a href=\"/purchase_data\" >ข้อมูลการสั่งซื้อ</a></li>\
          <li><a href=\"/bookdata\" >ข้อมูลหนังสือ</a></li>\
          <li><a href=\"/logout\" >ออกจากระบบ</a></li>"
          document.getElementById("login").innerHTML = x
        }
        else{
          console.log('custommer')
          x = "<li style=\"\" color : black;\"><a href=\"/status\">สถานะ</a></li>\
          <li><a href=\"/purchase_data\">ประวัติ</a></li><li><a href=\"./userinfo\">ข้อมูลรหัส</a></li>\
          <li><a href=\"/cart\" >Cart</a></li>\
          <li><a href=\"/logout\" >ออกจากระบบ</a></li>"
          document.getElementById("login").innerHTML = x
        }
    </script>
</body>
</html>